import{S as s,i as e,s as a,j as t,m as n,o as r,v as o,r as c,w as i,k as l,e as u,t as f,n as d,a1 as h,c as m,d as v,a as w,g as p,b as g,f as E,E as k,F as $,u as b,a2 as j,B as y}from"../../chunks/vendor-444b70c0.js";import{a as I,n as N}from"../../chunks/notificationStore-2bbb879e.js";import{T as L}from"../../chunks/Tabs-8fc662cb.js";import{L as S}from"../../chunks/LoadingSpinner-c96195f5.js";import"../../chunks/variables-9ef80d42.js";import"../../chunks/stores-4f414b9c.js";function A(s){let e,a;return e=new S({}),{c(){t(e.$$.fragment)},l(s){n(e.$$.fragment,s)},m(s,t){r(e,s,t),a=!0},i(s){a||(o(e.$$.fragment,s),a=!0)},o(s){c(e.$$.fragment,s),a=!1},d(s){i(e,s)}}}function D(s){let e,a,I,N,S,D,T,x,U,V,P,Q,B,H,M,q,F,G,O,R,C,_,z,J,K,W,X,Y,Z,ss,es;e=new L({});let as=s[0]&&A();return{c(){t(e.$$.fragment),a=l(),as&&as.c(),I=l(),N=u("meta"),S=l(),D=u("div"),T=u("div"),x=u("div"),U=u("header"),V=u("h1"),P=f("Email Notifications"),Q=l(),B=u("small"),H=f("Select notification settings below, all optional"),M=l(),q=u("div"),F=u("form"),G=u("div"),O=u("input"),R=l(),C=u("label"),_=f("New User"),z=l(),J=u("div"),K=u("input"),W=l(),X=u("label"),Y=f("New Quote"),this.h()},l(s){n(e.$$.fragment,s),a=d(s),as&&as.l(s),I=d(s);const t=h('[data-svelte="svelte-183ffmf"]',document.head);N=m(t,"META",{name:!0,content:!0}),t.forEach(v),S=d(s),D=m(s,"DIV",{class:!0});var r=w(D);T=m(r,"DIV",{class:!0});var o=w(T);x=m(o,"DIV",{class:!0});var c=w(x);U=m(c,"HEADER",{class:!0});var i=w(U);V=m(i,"H1",{});var l=w(V);P=p(l,"Email Notifications"),l.forEach(v),Q=d(i),B=m(i,"SMALL",{});var u=w(B);H=p(u,"Select notification settings below, all optional"),u.forEach(v),i.forEach(v),M=d(c),q=m(c,"DIV",{class:!0});var f=w(q);F=m(f,"FORM",{class:!0});var g=w(F);G=m(g,"DIV",{class:!0});var E=w(G);O=m(E,"INPUT",{id:!0,type:!0,value:!0,checked:!0,class:!0}),R=d(E),C=m(E,"LABEL",{for:!0,class:!0});var k=w(C);_=p(k,"New User"),k.forEach(v),E.forEach(v),z=d(g),J=m(g,"DIV",{class:!0});var $=w(J);K=m($,"INPUT",{id:!0,type:!0,value:!0,checked:!0,class:!0}),W=d($),X=m($,"LABEL",{for:!0,class:!0});var b=w(X);Y=p(b,"New Quote"),b.forEach(v),$.forEach(v),g.forEach(v),f.forEach(v),c.forEach(v),o.forEach(v),r.forEach(v),this.h()},h(){document.title="Admin Settings",g(N,"name","robots"),g(N,"content","noindex, nofollow"),g(U,"class","card-header"),g(O,"id","option1"),g(O,"type","checkbox"),O.value="user",O.checked=s[1],g(O,"class","svelte-1wwt7fj"),g(C,"for","option1"),g(C,"class","svelte-1wwt7fj"),g(G,"class","inputGroup svelte-1wwt7fj"),g(K,"id","option2"),g(K,"type","checkbox"),K.value="quote",K.checked=s[2],g(K,"class","svelte-1wwt7fj"),g(X,"for","option2"),g(X,"class","svelte-1wwt7fj"),g(J,"class","inputGroup svelte-1wwt7fj"),g(F,"class","form svelte-1wwt7fj"),g(q,"class","card-body"),g(x,"class","card is-6"),g(T,"class","columns is-centered"),g(D,"class","container")},m(t,n){r(e,t,n),E(t,a,n),as&&as.m(t,n),E(t,I,n),k(document.head,N),E(t,S,n),E(t,D,n),k(D,T),k(T,x),k(x,U),k(U,V),k(V,P),k(U,Q),k(U,B),k(B,H),k(x,M),k(x,q),k(q,F),k(F,G),k(G,O),k(G,R),k(G,C),k(C,_),k(F,z),k(F,J),k(J,K),k(J,W),k(J,X),k(X,Y),Z=!0,ss||(es=[$(O,"change",s[3]),$(K,"change",s[3])],ss=!0)},p(s,[e]){s[0]?as?1&e&&o(as,1):(as=A(),as.c(),o(as,1),as.m(I.parentNode,I)):as&&(y(),c(as,1,1,(()=>{as=null})),b()),(!Z||2&e)&&(O.checked=s[1]),(!Z||4&e)&&(K.checked=s[2])},i(s){Z||(o(e.$$.fragment,s),o(as),Z=!0)},o(s){c(e.$$.fragment,s),c(as),Z=!1},d(s){i(e,s),s&&v(a),as&&as.d(s),s&&v(I),v(N),s&&v(S),s&&v(D),ss=!1,j(es)}}}async function T({session:s}){return s.user&&"admin"===s.user.role&&s.authenticated?{props:{token:s.token,user:s.user}}:{status:302,redirect:"/"}}function x(s,e,a){let t,n,r,{token:o}=e,{user:c}=e,i=!0;return(async()=>{const s=await I("POST",`user/settings/${c.username}`,{},o);if(s.status>=400)throw a(0,i=!1),new Error(s.message);return a(0,i=!1),r=s._id,a(2,n=s.settings.newQuote),a(1,t=s.settings.newUser)})().catch((s=>{a(0,i=!1),N.warning(s.message)})),s.$$set=s=>{"token"in s&&a(4,o=s.token),"user"in s&&a(5,c=s.user)},[i,t,n,async function(s){"user"===s.target.value&&a(1,t=!t),"quote"===s.target.value&&a(2,n=!n);const e={newUser:t,newQuote:n,userId:r};try{const s=await I("PATCH","admin/update-settings",e,o);if(s.status>=400)throw new Error(s.message)}catch(c){N.warning(c.message)}},o,c]}export default class extends s{constructor(s){super(),e(this,s,x,D,a,{token:4,user:5})}}export{T as load};
